name: GCloud Setup

on:
  workflow_call:

jobs:
  auth:
    runs-on: ubuntu-latest
    outputs:
      project: ${{ steps.set.outputs.project }}
      region: ${{ steps.set.outputs.region }}
    steps:
      - name: Set up gcloud credentials
        id: set
        uses: google-github-actions/auth@v1
        with:
          credentials_json: ${{ secrets.GCP_SA_KEY }}

      - name: Configure project and region
        id: cfg
        run: |
          if [ -n "${{ inputs.gcp_project }}" ]; then
            echo "project=${{ inputs.gcp_project }}" >> "$GITHUB_OUTPUT"
            gcloud config set project "${{ inputs.gcp_project }}"
          else
            # nothing provided â€” leave current project
            echo "project=$(gcloud config get-value project 2>/dev/null || true)" >> "$GITHUB_OUTPUT"
          fi
          if [ -n "${{ inputs.gcp_region }}" ]; then
            echo "region=${{ inputs.gcp_region }}" >> "$GITHUB_OUTPUT"
            gcloud config set run/region "${{ inputs.gcp_region }}"
          else
            echo "region=$(gcloud config get-value run/region 2>/dev/null || true)" >> "$GITHUB_OUTPUT"
          fi
